<div class="addresses-shell">
  <section class="addresses-header">
    <div>
      <h1>{{ 'addresses.title' | translate }}</h1>
      <p class="muted">{{ 'addresses.subtitle' | translate }}</p>
    </div>
    <form [formGroup]="filterForm" class="filters" novalidate>
      <mat-form-field appearance="fill">
        <mat-label>{{ 'addresses.filters.type.label' | translate }}</mat-label>
        <mat-select formControlName="type" (selectionChange)="onFilterChange()">
          <mat-option value="">{{ 'addresses.filters.type.any' | translate }}</mat-option>
          <mat-option value="shipping">{{ 'addresses.filters.type.shipping' | translate }}</mat-option>
          <mat-option value="billing">{{ 'addresses.filters.type.billing' | translate }}</mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-raised-button color="primary" type="button" (click)="openCreate()">
        <mat-icon>add</mat-icon>
        {{ 'addresses.actions.create' | translate }}
      </button>
    </form>
  </section>

  <section class="table-wrapper">
    <app-loading [show]="loading" labelKey="common.loading"></app-loading>

    <table mat-table [dataSource]="dataSource" *ngIf="dataSource?.length; else emptyState">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>{{ 'addresses.table.name' | translate }}</th>
        <td mat-cell *matCellDef="let address">
          <div class="address-name">{{ address.name || address.line1 }}</div>
          <div class="muted" *ngIf="address.company">{{ address.company }}</div>
        </td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef>{{ 'addresses.table.type' | translate }}</th>
        <td mat-cell *matCellDef="let address">
          {{ ('addresses.types.' + address.type) | translate }}
        </td>
      </ng-container>

      <ng-container matColumnDef="location">
        <th mat-header-cell *matHeaderCellDef>{{ 'addresses.table.location' | translate }}</th>
        <td mat-cell *matCellDef="let address">
          <div>{{ address.line1 }}</div>
          <div *ngIf="address.line2">{{ address.line2 }}</div>
          <div class="muted">
            {{ address.city }}
            <span *ngIf="address.region">{{ address.region }}</span>
            <span *ngIf="address.postalCode">{{ address.postalCode }}</span>
            <span *ngIf="address.country">{{ address.country }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef>{{ 'addresses.table.phone' | translate }}</th>
        <td mat-cell *matCellDef="let address">{{ address.phone || 'â€”' }}</td>
      </ng-container>

      <ng-container matColumnDef="default">
        <th mat-header-cell *matHeaderCellDef>{{ 'addresses.table.default' | translate }}</th>
        <td mat-cell *matCellDef="let address">
          <span class="tag default" *ngIf="address.isDefault">{{ 'addresses.labels.default' | translate }}</span>
          <button
            mat-stroked-button
            color="primary"
            type="button"
            *ngIf="!address.isDefault"
            (click)="setDefault(address)"
            [disabled]="loading"
          >
            {{ 'addresses.actions.setDefault' | translate }}
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>{{ 'addresses.table.actions' | translate }}</th>
        <td mat-cell *matCellDef="let address">
          <button mat-icon-button color="primary" (click)="openEdit(address)" [attr.aria-label]="'addresses.actions.edit' | translate">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="confirmDelete(address)" [disabled]="loading" [attr.aria-label]="'addresses.actions.delete' | translate">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns; trackBy: trackById"></tr>
    </table>

    <ng-template #emptyState>
      <div class="empty-state">
        <mat-icon>home</mat-icon>
        <p>{{ 'addresses.empty' | translate }}</p>
      </div>
    </ng-template>
  </section>

  <mat-paginator
    [length]="total"
    [pageIndex]="pageIndex"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    (page)="onPageChange($event)"
    showFirstLastButtons
  ></mat-paginator>

  <app-error-banner [key]="errorKey" [error]="lastError"></app-error-banner>
</div>
