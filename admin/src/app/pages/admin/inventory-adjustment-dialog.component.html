<h2 mat-dialog-title>{{ 'inventory.adjustDialog.title' | translate }}</h2>
<mat-dialog-content class="adjust-dialog">
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <mat-form-field appearance="outline" class="adjust-dialog__field">
      <mat-label>{{ 'inventory.adjustDialog.fields.product' | translate }}</mat-label>
      <input
        matInput
        formControlName="productSearch"
        [matAutocomplete]="productAuto"
        [placeholder]="'inventory.adjustDialog.fields.productPlaceholder' | translate"
      />
      <mat-progress-spinner
        *ngIf="form.controls.productId.invalid && form.touched"
        diameter="16"
        mode="indeterminate"
        class="adjust-dialog__spinner"
      ></mat-progress-spinner>
      <mat-autocomplete #productAuto="matAutocomplete" (optionSelected)="onProductSelected($event)" [displayWith]="displayProduct">
        <mat-option *ngFor="let product of productResults$ | async" [value]="product">
          <span class="adjust-dialog__option-name">{{ product.name }}</span>
          <span class="adjust-dialog__option-sku" *ngIf="product.sku">{{ product.sku }}</span>
        </mat-option>
      </mat-autocomplete>
      <mat-error *ngIf="form.controls.productId.invalid">{{ 'inventory.adjustDialog.errors.productRequired' | translate }}</mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="adjust-dialog__field">
      <mat-label>{{ 'inventory.adjustDialog.fields.variant' | translate }}</mat-label>
      <mat-select formControlName="variantId" [disabled]="loadingVariants || !variants.length">
        <mat-option value="">{{ 'inventory.adjustDialog.fields.variantAny' | translate }}</mat-option>
        <mat-option *ngFor="let variant of variants" [value]="variant.id">{{ variant.label || variant.id }}</mat-option>
      </mat-select>
      <mat-hint *ngIf="loadingVariants">{{ 'inventory.adjustDialog.loadingVariants' | translate }}</mat-hint>
    </mat-form-field>

    <div class="adjust-dialog__quantity">
      <mat-form-field appearance="outline">
        <mat-label>{{ 'inventory.adjustDialog.fields.quantity' | translate }}</mat-label>
        <input matInput type="number" formControlName="quantity" min="1" />
        <mat-error *ngIf="form.controls.quantity.hasError('required')">{{ 'inventory.adjustDialog.errors.quantityRequired' | translate }}</mat-error>
        <mat-error *ngIf="form.controls.quantity.hasError('min')">{{ 'inventory.adjustDialog.errors.quantityPositive' | translate }}</mat-error>
      </mat-form-field>
      <mat-button-toggle-group formControlName="direction" [attr.aria-label]="'inventory.adjustDialog.fields.direction' | translate">
        <mat-button-toggle value="add">{{ 'inventory.adjustDialog.directions.add' | translate }}</mat-button-toggle>
        <mat-button-toggle value="remove">{{ 'inventory.adjustDialog.directions.remove' | translate }}</mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <mat-form-field appearance="outline" class="adjust-dialog__field">
      <mat-label>{{ 'inventory.adjustDialog.fields.reason' | translate }}</mat-label>
      <mat-select formControlName="reason">
        <mat-option *ngFor="let reason of reasons" [value]="reason.value">{{ reason.labelKey | translate }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="adjust-dialog__field">
      <mat-label>{{ 'inventory.adjustDialog.fields.note' | translate }}</mat-label>
      <textarea matInput formControlName="note" rows="3"></textarea>
    </mat-form-field>

    <div class="adjust-dialog__actions">
      <button mat-button type="button" mat-dialog-close [disabled]="saving">
        {{ 'common.actions.cancel' | translate }}
      </button>
      <button mat-raised-button color="primary" type="submit" [disabled]="saving || form.invalid">
        <mat-progress-spinner *ngIf="saving" mode="indeterminate" diameter="18"></mat-progress-spinner>
        <span>{{ 'inventory.adjustDialog.actions.save' | translate }}</span>
      </button>
    </div>
  </form>
</mat-dialog-content>
