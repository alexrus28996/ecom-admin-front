<h2 mat-dialog-title>{{ 'inventory.adjustDialog.title' | translate }}</h2>

<mat-dialog-content class="adjust-dialog">
  <form [formGroup]="form" (ngSubmit)="submit()">
    <div class="adjust-dialog__product">
      <mat-form-field appearance="outline" class="adjust-dialog__field">
        <mat-label>{{ 'inventory.adjustDialog.fields.product' | translate }}</mat-label>
        <input
          matInput
          [formControl]="productControl"
          [matAutocomplete]="productAuto"
          [placeholder]="'inventory.adjustDialog.fields.productPlaceholder' | translate"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          *ngIf="productControl.value"
          (click)="clearProductSelection()"
          [disabled]="saving"
          [attr.aria-label]="'inventory.adjustDialog.actions.clearProduct' | translate"
        >
          <mat-icon>close</mat-icon>
        </button>
        <mat-progress-spinner
          *ngIf="loadingProducts"
          matSuffix
          diameter="18"
          mode="indeterminate"
          class="adjust-dialog__spinner"
        ></mat-progress-spinner>
        <mat-autocomplete
          #productAuto="matAutocomplete"
          (optionSelected)="onProductSelected($event)"
          [displayWith]="displayProductOption"
        >
          <mat-option *ngIf="!loadingProducts && !productOptions.length" disabled>
            {{ 'inventory.adjustDialog.emptyStates.noProducts' | translate }}
          </mat-option>
          <mat-option *ngFor="let option of productOptions" [value]="option">
            <span class="adjust-dialog__option-title">{{ option.label }}</span>
            <span class="adjust-dialog__option-subtitle" *ngIf="option.secondaryLabel">
              {{ 'inventory.adjustDialog.labels.sku' | translate: { sku: option.secondaryLabel } }}
            </span>
          </mat-option>
        </mat-autocomplete>
        <mat-error *ngIf="productControl.hasError('required')">
          {{ 'inventory.adjustDialog.validation.productRequired' | translate }}
        </mat-error>
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline" class="adjust-dialog__field">
      <mat-label>{{ 'inventory.adjustDialog.fields.variant' | translate }}</mat-label>
      <mat-select formControlName="variantId" [disabled]="loadingVariants || !variantOptions.length">
        <mat-option value="">{{ 'inventory.adjustDialog.labels.allVariants' | translate }}</mat-option>
        <mat-option *ngFor="let variant of variantOptions" [value]="variant.id">{{ variant.label }}</mat-option>
      </mat-select>
      <mat-hint *ngIf="loadingVariants">{{ 'inventory.adjustDialog.loadingVariants' | translate }}</mat-hint>
    </mat-form-field>

    <div class="adjust-dialog__quantity">
      <mat-form-field appearance="outline">
        <mat-label>{{ 'inventory.adjustDialog.fields.quantity' | translate }}</mat-label>
        <input matInput type="number" formControlName="quantity" min="1" />
        <mat-error *ngIf="form.controls.quantity.hasError('required')">
          {{ 'inventory.adjustDialog.validation.quantityRequired' | translate }}
        </mat-error>
        <mat-error *ngIf="form.controls.quantity.hasError('min')">
          {{ 'inventory.adjustDialog.validation.quantityPositive' | translate }}
        </mat-error>
      </mat-form-field>

      <mat-button-toggle-group formControlName="direction" [attr.aria-label]="'inventory.adjustDialog.fields.direction' | translate">
        <mat-button-toggle value="increase">
          {{ 'inventory.adjustDialog.labels.increase' | translate }}
        </mat-button-toggle>
        <mat-button-toggle value="decrease">
          {{ 'inventory.adjustDialog.labels.decrease' | translate }}
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <mat-form-field appearance="outline" class="adjust-dialog__field">
      <mat-label>{{ 'inventory.adjustDialog.fields.reason' | translate }}</mat-label>
      <mat-select formControlName="reason">
        <mat-option *ngFor="let reason of reasons" [value]="reason.value">{{ reason.labelKey | translate }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="adjust-dialog__field">
      <mat-label>{{ 'inventory.adjustDialog.fields.location' | translate }}</mat-label>
      <input matInput formControlName="location" />
    </mat-form-field>

    <mat-form-field appearance="outline" class="adjust-dialog__field">
      <mat-label>{{ 'inventory.adjustDialog.fields.note' | translate }}</mat-label>
      <textarea matInput formControlName="note" rows="3"></textarea>
    </mat-form-field>

    <div class="adjust-dialog__actions">
      <button mat-button type="button" mat-dialog-close [disabled]="saving">
        {{ 'common.actions.cancel' | translate }}
      </button>
      <button mat-flat-button color="primary" type="submit" [disabled]="saving || form.invalid || productControl.invalid">
        <mat-progress-spinner *ngIf="saving" mode="indeterminate" diameter="18"></mat-progress-spinner>
        <span>{{ 'inventory.adjustDialog.actions.submit' | translate }}</span>
      </button>
    </div>
  </form>
</mat-dialog-content>
