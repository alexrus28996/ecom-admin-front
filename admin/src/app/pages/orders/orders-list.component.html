<div class="orders-page">
  <section class="orders-page__header">
    <div>
      <span class="orders-page__eyebrow">{{ 'orders.title' | translate }}</span>
      <h1>{{ 'orders.userList' | translate }}</h1>
      <p class="muted">{{ 'orders.descriptionUser' | translate }}</p>
    </div>
    <button mat-stroked-button color="primary" type="button" (click)="load()" [disabled]="loading">
      <mat-icon>refresh</mat-icon>
      {{ 'orders.actions.refresh' | translate }}
    </button>
  </section>

  <section class="orders-page__table">
    <div class="orders-page__table-inner">
      <ng-container *ngIf="loading && !rows.length; else tableContent">
        <div class="orders-page__skeleton" *ngFor="let _ of skeletonRows"></div>
      </ng-container>

      <ng-template #tableContent>
        <table mat-table [dataSource]="rows" *ngIf="rows.length; else emptyState" class="orders-page__mat-table">
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>{{ 'orders.id' | translate }}</th>
            <td mat-cell *matCellDef="let order">
              <a [routerLink]="['/orders', order._id]" class="orders-page__link">{{ order._id }}</a>
            </td>
          </ng-container>

          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef>{{ 'orders.createdAt' | translate }}</th>
            <td mat-cell *matCellDef="let order">{{ order.createdAt | date:'medium' }}</td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>{{ 'orders.statusLabel' | translate }}</th>
            <td mat-cell *matCellDef="let order">
              <span [ngClass]="statusChipClass(order.status)">{{ statusKey(order.status) | translate }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="total">
            <th mat-header-cell *matHeaderCellDef>{{ 'orders.total' | translate }}</th>
            <td mat-cell *matCellDef="let order">
              <ng-container *ngIf="totalFor(order) as total">
                {{ total.amount | number:'1.2-2' }} {{ total.currency }}
              </ng-container>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="orders-page__actions-header">{{ 'orders.actionColumn' | translate }}</th>
            <td mat-cell *matCellDef="let order">
              <button mat-icon-button color="primary" [routerLink]="['/orders', order._id]" [attr.aria-label]="'orders.view' | translate">
                <mat-icon>open_in_new</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let order; columns: displayedColumns; trackBy: trackById"></tr>
        </table>

        <ng-template #emptyState>
          <div class="empty-state">
            <mat-icon>inventory_2</mat-icon>
            <p>{{ 'orders.empty' | translate }}</p>
          </div>
        </ng-template>
      </ng-template>
    </div>

    <mat-paginator
      [length]="total"
      [pageIndex]="pageIndex"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      showFirstLastButtons
    ></mat-paginator>
  </section>

  <app-error-banner [key]="errorKey" [error]="lastError"></app-error-banner>
</div>
