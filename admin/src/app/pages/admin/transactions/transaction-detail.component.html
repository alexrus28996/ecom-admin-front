<section class="transaction-detail" *ngIf="!loading && transaction; else loadingTpl">
  <button mat-button (click)="back()">
    <mat-icon>arrow_back</mat-icon>
    Back to transactions
  </button>

  <header>
    <div>
      <h1>Transaction {{ transaction?._id }}</h1>
      <p>Order: {{ transaction?.order?.['orderNumber'] || transaction?.order?.['number'] || transaction?.order }}</p>
    </div>
    <span [class]="'status-pill ' + (transaction?.status | lowercase)">{{ transaction?.status | titlecase }}</span>
  </header>

  <mat-grid-list cols="2" rowHeight="fit" gutterSize="16">
    <mat-grid-tile>
      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Payment details</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <dl>
            <div>
              <dt>Provider</dt>
              <dd>{{ transaction?.provider || '—' }}</dd>
            </div>
            <div>
              <dt>Amount</dt>
              <dd>{{ transaction?.amount?.amount | number:'1.2-2' }} {{ transaction?.currency || transaction?.amount?.currency }}</dd>
            </div>
            <div>
              <dt>Status</dt>
              <dd>{{ transaction?.status | titlecase }}</dd>
            </div>
            <div>
              <dt>Captured</dt>
              <dd>{{ transaction?.capturedAt ? (transaction?.capturedAt | date:'medium') : '—' }}</dd>
            </div>
            <div>
              <dt>Created</dt>
              <dd>{{ transaction?.createdAt | date:'medium' }}</dd>
            </div>
            <div>
              <dt>External ID</dt>
              <dd>{{ transaction?.externalId || '—' }}</dd>
            </div>
          </dl>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Provider payload</mat-card-title>
          <mat-card-subtitle>Raw payload captured for debugging</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <pre>{{ rawPayload }}</pre>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>
  </mat-grid-list>
</section>

<ng-template #loadingTpl>
  <div class="loading-state">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    <span *ngIf="!error">Loading transaction…</span>
    <span *ngIf="error">{{ error }}</span>
  </div>
</ng-template>
