<section class="shipment-detail" *ngIf="!loading && shipment; else loadingTpl">
  <button mat-button (click)="back()">
    <mat-icon>arrow_back</mat-icon>
    Back to shipments
  </button>

  <header>
    <div>
      <h1>Shipment {{ shipment?._id }}</h1>
      <p>Order: {{ shipment?.order?.['orderNumber'] || shipment?.order?.['number'] || shipment?.order }}</p>
    </div>
    <span [class]="statusClass(shipment?.status || '')">{{ shipment?.status | titlecase }}</span>
  </header>

  <mat-grid-list cols="2" rowHeight="fit" gutterSize="16">
    <mat-grid-tile>
      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Shipment info</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <dl>
            <div>
              <dt>Carrier</dt>
              <dd>{{ shipment?.carrier || '—' }}</dd>
            </div>
            <div>
              <dt>Tracking</dt>
              <dd>{{ shipment?.tracking || shipment?.trackingNumber || '—' }}</dd>
            </div>
            <div>
              <dt>Service</dt>
              <dd>{{ shipment?.service || '—' }}</dd>
            </div>
            <div>
              <dt>Estimated delivery</dt>
              <dd>{{ shipment?.estimatedDelivery ? (shipment?.estimatedDelivery | date:'medium') : '—' }}</dd>
            </div>
            <div>
              <dt>Created</dt>
              <dd>{{ shipment?.createdAt | date:'medium' }}</dd>
            </div>
          </dl>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Items</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <table mat-table [dataSource]="shipment?.items || []">
            <ng-container matColumnDef="item">
              <th mat-header-cell *matHeaderCellDef>Item</th>
              <td mat-cell *matCellDef="let item">{{ item.orderItem }}</td>
            </ng-container>
            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef>Quantity</th>
              <td mat-cell *matCellDef="let item">{{ item.quantity }}</td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="['item','quantity']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['item','quantity']"></tr>
          </table>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>
  </mat-grid-list>
</section>

<ng-template #loadingTpl>
  <div class="loading-state">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    <span *ngIf="!error">Loading shipment…</span>
    <span *ngIf="error">{{ error }}</span>
  </div>
</ng-template>
