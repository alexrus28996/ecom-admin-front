<div class="panel">
  <section class="header" style="display:flex;align-items:flex-end;justify-content:space-between;gap:16px;flex-wrap:wrap;">
    <div>
      <h2>{{ 'adminUsers.list.title' | translate }}</h2>
      <p class="muted">{{ 'adminUsers.list.subtitle' | translate }}</p>
    </div>
    <form (ngSubmit)="onSearch()" class="filters" novalidate style="display:flex;gap:12px;align-items:flex-end;">
      <mat-form-field appearance="fill">
        <mat-label>{{ 'adminUsers.list.filters.search' | translate }}</mat-label>
        <input matInput [formControl]="q" [placeholder]="'adminUsers.list.filters.placeholder' | translate" />
        <button mat-icon-button matSuffix type="submit"><mat-icon>search</mat-icon></button>
      </mat-form-field>
    </form>
  </section>

  <section class="table-wrapper" style="position:relative;">
    <app-loading [show]="loading" labelKey="common.loading"></app-loading>
    <table mat-table [dataSource]="rows" *ngIf="rows.length; else emptyState">
      <ng-container matColumnDef="name"><th mat-header-cell *matHeaderCellDef>{{ 'adminUsers.list.table.name' | translate }}</th><td mat-cell *matCellDef="let u">{{ u.name }}</td></ng-container>
      <ng-container matColumnDef="email"><th mat-header-cell *matHeaderCellDef>{{ 'adminUsers.list.table.email' | translate }}</th><td mat-cell *matCellDef="let u">{{ u.email }}</td></ng-container>
      <ng-container matColumnDef="roles"><th mat-header-cell *matHeaderCellDef>{{ 'adminUsers.list.table.roles' | translate }}</th><td mat-cell *matCellDef="let u">{{ (u.roles || []).join(', ') }}</td></ng-container>
      <ng-container matColumnDef="active"><th mat-header-cell *matHeaderCellDef>{{ 'adminUsers.list.table.active' | translate }}</th><td mat-cell *matCellDef="let u"><mat-slide-toggle [checked]="u.isActive" (change)="toggle(u)">{{ u.isActive ? ('adminUsers.list.status.active' | translate) : ('adminUsers.list.status.inactive' | translate) }}</mat-slide-toggle></td></ng-container>
      <ng-container matColumnDef="actions"><th mat-header-cell *matHeaderCellDef>{{ 'adminUsers.list.table.actions' | translate }}</th><td mat-cell *matCellDef="let u"></td></ng-container>
      <tr mat-header-row *matHeaderRowDef="displayed"></tr>
      <tr mat-row *matRowDef="let row; columns: displayed"></tr>
    </table>
    <ng-template #emptyState><div class="empty-state"><mat-icon>group</mat-icon><p>{{ 'adminUsers.list.empty' | translate }}</p></div></ng-template>
    <app-error-banner [key]="errorKey"></app-error-banner>
  </section>

  <mat-paginator [length]="total" [pageIndex]="pageIndex" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions" (page)="onPage($event)" showFirstLastButtons></mat-paginator>
</div>
