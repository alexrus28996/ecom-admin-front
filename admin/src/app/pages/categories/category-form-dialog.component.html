<h2 mat-dialog-title>{{ isEdit ? 'Edit category' : 'Create category' }}</h2>
<form class="category-form" [formGroup]="form" (ngSubmit)="save()" novalidate>
  <mat-dialog-content>
    <div class="form-grid">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Name</mat-label>
        <input matInput formControlName="name" required />
        <mat-error *ngIf="form.get('name')?.hasError('required')">Name is required</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Slug</mat-label>
        <input matInput formControlName="slug" required (input)="onSlugInput()" />
        <mat-hint>Use lowercase letters, numbers, and hyphens only.</mat-hint>
        <mat-error *ngIf="form.get('slug')?.hasError('required')">Slug is required</mat-error>
        <mat-error *ngIf="form.get('slug')?.hasError('pattern')">Invalid slug</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Parent category</mat-label>
        <mat-select formControlName="parent">
          <mat-option *ngFor="let option of parents" [value]="option.id" [disabled]="option.disabled">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-slide-toggle formControlName="isActive">Active</mat-slide-toggle>

      <mat-form-field appearance="outline" class="full-width full-span">
        <mat-label>Description</mat-label>
        <textarea matInput formControlName="description" rows="3"></textarea>
      </mat-form-field>
    </div>

    <section class="media-section">
      <h3>Media</h3>
      <div class="media-grid">
        <div class="media-field">
          <h4>Thumbnail</h4>
          <div class="media-preview" *ngIf="form.get('imageUrl')?.value">
            <img [src]="form.get('imageUrl')?.value" alt="Category thumbnail" />
            <button mat-icon-button type="button" (click)="clearMedia('imageUrl')">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <button mat-stroked-button type="button" (click)="thumbnailInput.click()" [disabled]="uploadState.imageUrl">
            <mat-icon>file_upload</mat-icon>
            Upload thumbnail
          </button>
          <mat-progress-bar mode="indeterminate" *ngIf="uploadState.imageUrl"></mat-progress-bar>
          <input #thumbnailInput type="file" accept="image/*" (change)="uploadImage('imageUrl', $event)" hidden />
        </div>

        <div class="media-field">
          <h4>Banner</h4>
          <div class="media-preview" *ngIf="form.get('bannerUrl')?.value">
            <img [src]="form.get('bannerUrl')?.value" alt="Category banner" />
            <button mat-icon-button type="button" (click)="clearMedia('bannerUrl')">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <button mat-stroked-button type="button" (click)="bannerInput.click()" [disabled]="uploadState.bannerUrl">
            <mat-icon>file_upload</mat-icon>
            Upload banner
          </button>
          <mat-progress-bar mode="indeterminate" *ngIf="uploadState.bannerUrl"></mat-progress-bar>
          <input #bannerInput type="file" accept="image/*" (change)="uploadImage('bannerUrl', $event)" hidden />
        </div>

        <div class="media-field">
          <h4>Icon</h4>
          <div class="media-preview" *ngIf="form.get('iconUrl')?.value">
            <img [src]="form.get('iconUrl')?.value" alt="Category icon" />
            <button mat-icon-button type="button" (click)="clearMedia('iconUrl')">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <button mat-stroked-button type="button" (click)="iconInput.click()" [disabled]="uploadState.iconUrl">
            <mat-icon>file_upload</mat-icon>
            Upload icon
          </button>
          <mat-progress-bar mode="indeterminate" *ngIf="uploadState.iconUrl"></mat-progress-bar>
          <input #iconInput type="file" accept="image/*" (change)="uploadImage('iconUrl', $event)" hidden />
        </div>
      </div>
    </section>

    <mat-expansion-panel class="seo-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>SEO settings</mat-panel-title>
        <mat-panel-description>Optimise how this category appears in search results.</mat-panel-description>
      </mat-expansion-panel-header>
      <div class="seo-grid">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Meta title</mat-label>
          <input matInput formControlName="metaTitle" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Meta description</mat-label>
          <textarea matInput formControlName="metaDescription" rows="3"></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Meta keywords</mat-label>
          <mat-chip-grid #keywordList aria-label="Category keywords">
            <mat-chip
              *ngFor="let keyword of metaKeywords"
              [removable]="true"
              (removed)="removeKeyword(keyword)"
            >
              {{ keyword }}
              <button matChipRemove mat-icon-button type="button">
                <mat-icon>close</mat-icon>
              </button>
            </mat-chip>
            <input
              [formControl]="keywordInput"
              [matChipInputFor]="keywordList"
              [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
              [matChipInputAddOnBlur]="true"
              (matChipInputTokenEnd)="addKeyword($event)"
              placeholder="Add keyword"
            />
          </mat-chip-grid>
        </mat-form-field>
      </div>
    </mat-expansion-panel>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button type="button" (click)="cancel()">Cancel</button>
    <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid || isSaving">
      {{ isSaving ? 'Saving...' : 'Save' }}
    </button>
  </mat-dialog-actions>
</form>
