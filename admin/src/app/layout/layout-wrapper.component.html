<div class="layout-wrapper"
     [class.layout-wrapper--collapsed]="navCollapsed"
     [class.layout-wrapper--mobile-nav-open]="mobileNavOpen"
     [class.layout-wrapper--handset]="(isHandset$ | async) ?? false">

  <!-- Enterprise Sidebar -->
  <app-sidebar
    class="layout-wrapper__sidebar"
    [items]="visibleNav$ | async"
    [collapsed]="navCollapsed"
    [mobileOpen]="mobileNavOpen"
    [handset]="(isHandset$ | async) ?? false"
    (toggleCollapse)="toggleSidebar()"
    (closeMobile)="closeMobileNav()"
  ></app-sidebar>

  <!-- Main Content Area -->
  <div class="layout-wrapper__main">
    <!-- Enhanced Top Navigation -->
    <app-topbar
      class="layout-wrapper__topbar"
      [isDark]="isDark"
      [isHandset]="(isHandset$ | async) ?? false"
      [user]="auth.user$ | async"
      [searchControl]="searchControl"
      [searchPlaceholder]="searchPlaceholder"
      [searchModule]="searchModuleLabel"
      [searchHint]="searchHint"
      [searchIcon]="searchIcon"
      [searchEnabled]="searchEnabled"
      [refreshing]="(auth.refreshing$ | async) ?? false"
      (menuClick)="openMobileNav()"
      (toggleTheme)="toggleTheme()"
      (logout)="logout()"
      (search)="submitSearch($event)"
    ></app-topbar>

    <!-- Auto-generated Breadcrumb Navigation -->
    <app-breadcrumb
      *ngIf="breadcrumbs.length > 0"
      class="layout-wrapper__breadcrumbs"
      [items]="breadcrumbs"
    ></app-breadcrumb>

    <!-- Page Content with Proper Scrolling -->
    <main class="layout-wrapper__content">
      <div class="layout-wrapper__surface">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>

  <!-- Mobile Navigation Backdrop -->
  <div
    class="layout-wrapper__backdrop"
    *ngIf="mobileNavOpen"
    (click)="closeMobileNav()"
    aria-hidden="true">
  </div>
</div>
